# Commit message format validation
commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Color codes
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Check commit message format (Conventional Commits)
if ! echo "$commit_msg" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|release)(\(.+\))?: .{1,}|^release v[0-9]+\.[0-9]+\.[0-9]+: .{1,}"; then
    echo "${RED}✗ Invalid commit message format${NC}"
    echo ""
    echo "${YELLOW}Commit message must follow Conventional Commits format:${NC}"
    echo "  <type>(<scope>): <description>"
    echo ""
    echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, release"
    echo ""
    echo "Examples:"
    echo "  feat(circuits): add new disclosure circuit"
    echo "  fix(setup): correct proving key generation"
    echo "  docs: update README with build instructions"
    exit 1
fi

# Check minimum commit message length
if [ ${#commit_msg} -lt 10 ]; then
    echo "${RED}✗ Commit message too short (minimum 10 characters)${NC}"
    exit 1
fi
